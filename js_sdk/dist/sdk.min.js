var Rimdian=function(){function i(e){"@babel/helpers - typeof";return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}var a=function(){a=Object.assign||function e(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o))t[o]=n[o]}return t};return a.apply(this,arguments)};var e=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var t={exports:{}};(function(S){(function(e){function g(e,t){var n=(e&65535)+(t&65535);var r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}function a(e,t){return e<<t|e>>>32-t}function s(e,t,n,r,i,o){return g(a(g(g(t,e),g(r,o)),i),n)}function l(e,t,n,r,i,o,a){return s(t&n|~t&r,e,t,i,o,a)}function f(e,t,n,r,i,o,a){return s(t&r|n&~r,e,t,i,o,a)}function _(e,t,n,r,i,o,a){return s(t^n^r,e,t,i,o,a)}function m(e,t,n,r,i,o,a){return s(n^(t|~r),e,t,i,o,a)}function c(e,t){e[t>>5]|=128<<t%32;e[(t+64>>>9<<4)+14]=t;var n;var r;var i;var o;var a;var s=1732584193;var c=-271733879;var u=-1732584194;var d=271733878;for(n=0;n<e.length;n+=16){r=s;i=c;o=u;a=d;s=l(s,c,u,d,e[n],7,-680876936);d=l(d,s,c,u,e[n+1],12,-389564586);u=l(u,d,s,c,e[n+2],17,606105819);c=l(c,u,d,s,e[n+3],22,-1044525330);s=l(s,c,u,d,e[n+4],7,-176418897);d=l(d,s,c,u,e[n+5],12,1200080426);u=l(u,d,s,c,e[n+6],17,-1473231341);c=l(c,u,d,s,e[n+7],22,-45705983);s=l(s,c,u,d,e[n+8],7,1770035416);d=l(d,s,c,u,e[n+9],12,-1958414417);u=l(u,d,s,c,e[n+10],17,-42063);c=l(c,u,d,s,e[n+11],22,-1990404162);s=l(s,c,u,d,e[n+12],7,1804603682);d=l(d,s,c,u,e[n+13],12,-40341101);u=l(u,d,s,c,e[n+14],17,-1502002290);c=l(c,u,d,s,e[n+15],22,1236535329);s=f(s,c,u,d,e[n+1],5,-165796510);d=f(d,s,c,u,e[n+6],9,-1069501632);u=f(u,d,s,c,e[n+11],14,643717713);c=f(c,u,d,s,e[n],20,-373897302);s=f(s,c,u,d,e[n+5],5,-701558691);d=f(d,s,c,u,e[n+10],9,38016083);u=f(u,d,s,c,e[n+15],14,-660478335);c=f(c,u,d,s,e[n+4],20,-405537848);s=f(s,c,u,d,e[n+9],5,568446438);d=f(d,s,c,u,e[n+14],9,-1019803690);u=f(u,d,s,c,e[n+3],14,-187363961);c=f(c,u,d,s,e[n+8],20,1163531501);s=f(s,c,u,d,e[n+13],5,-1444681467);d=f(d,s,c,u,e[n+2],9,-51403784);u=f(u,d,s,c,e[n+7],14,1735328473);c=f(c,u,d,s,e[n+12],20,-1926607734);s=_(s,c,u,d,e[n+5],4,-378558);d=_(d,s,c,u,e[n+8],11,-2022574463);u=_(u,d,s,c,e[n+11],16,1839030562);c=_(c,u,d,s,e[n+14],23,-35309556);s=_(s,c,u,d,e[n+1],4,-1530992060);d=_(d,s,c,u,e[n+4],11,1272893353);u=_(u,d,s,c,e[n+7],16,-155497632);c=_(c,u,d,s,e[n+10],23,-1094730640);s=_(s,c,u,d,e[n+13],4,681279174);d=_(d,s,c,u,e[n],11,-358537222);u=_(u,d,s,c,e[n+3],16,-722521979);c=_(c,u,d,s,e[n+6],23,76029189);s=_(s,c,u,d,e[n+9],4,-640364487);d=_(d,s,c,u,e[n+12],11,-421815835);u=_(u,d,s,c,e[n+15],16,530742520);c=_(c,u,d,s,e[n+2],23,-995338651);s=m(s,c,u,d,e[n],6,-198630844);d=m(d,s,c,u,e[n+7],10,1126891415);u=m(u,d,s,c,e[n+14],15,-1416354905);c=m(c,u,d,s,e[n+5],21,-57434055);s=m(s,c,u,d,e[n+12],6,1700485571);d=m(d,s,c,u,e[n+3],10,-1894986606);u=m(u,d,s,c,e[n+10],15,-1051523);c=m(c,u,d,s,e[n+1],21,-2054922799);s=m(s,c,u,d,e[n+8],6,1873313359);d=m(d,s,c,u,e[n+15],10,-30611744);u=m(u,d,s,c,e[n+6],15,-1560198380);c=m(c,u,d,s,e[n+13],21,1309151649);s=m(s,c,u,d,e[n+4],6,-145523070);d=m(d,s,c,u,e[n+11],10,-1120210379);u=m(u,d,s,c,e[n+2],15,718787259);c=m(c,u,d,s,e[n+9],21,-343485551);s=g(s,r);c=g(c,i);u=g(u,o);d=g(d,a)}return[s,c,u,d]}function u(e){var t;var n="";var r=e.length*32;for(t=0;t<r;t+=8){n+=String.fromCharCode(e[t>>5]>>>t%32&255)}return n}function d(e){var t;var n=[];n[(e.length>>2)-1]=undefined;for(t=0;t<n.length;t+=1){n[t]=0}var r=e.length*8;for(t=0;t<r;t+=8){n[t>>5]|=(e.charCodeAt(t/8)&255)<<t%32}return n}function t(e){return u(c(d(e),e.length*8))}function n(e,t){var n;var r=d(e);var i=[];var o=[];var a;i[15]=o[15]=undefined;if(r.length>16){r=c(r,e.length*8)}for(n=0;n<16;n+=1){i[n]=r[n]^909522486;o[n]=r[n]^1549556828}a=c(i.concat(d(t)),512+t.length*8);return u(c(o.concat(a),512+128))}function r(e){var t="0123456789abcdef";var n="";var r;var i;for(i=0;i<e.length;i+=1){r=e.charCodeAt(i);n+=t.charAt(r>>>4&15)+t.charAt(r&15)}return n}function i(e){return unescape(encodeURIComponent(e))}function o(e){return t(i(e))}function v(e){return r(o(e))}function h(e,t){return n(i(e),i(t))}function p(e,t){return r(h(e,t))}function w(e,t,n){if(!t){if(!n){return v(e)}return o(e)}if(!n){return p(t,e)}return h(t,e)}if(S.exports){S.exports=w}else{e.md5=w}})(e)})(t);var r=t.exports;let n;try{new EventTarget,n=!0}catch(o){n=!1}class o{constructor(){this.e={}}addEventListener(e,t,n=!1){this.t(e).push(t)}removeEventListener(e,t,n=!1){const r=this.t(e),i=r.indexOf(t);i>-1&&r.splice(i,1)}dispatchEvent(t){return t.target=this,Object.freeze(t),this.t(t.type).forEach(e=>e(t)),!0}t(e){return this.e[e]=this.e[e]||[]}}var s=n?EventTarget:o;class c{constructor(e){this.type=e}}var u=n?Event:c;class d extends u{constructor(e,t){super(e),this.newState=t.newState,this.oldState=t.oldState,this.originalEvent=t.originalEvent}}const g="active",l="passive",f="hidden",_="frozen",m="terminated",v="object"==typeof safari&&safari.pushNotification,h="onpageshow"in self,p=["focus","blur","visibilitychange","freeze","resume","pageshow",h?"pagehide":"unload"],w=e=>(e.preventDefault(),e.returnValue="Are you sure?"),S=e=>e.reduce((e,t,n)=>(e[t]=n,e),{}),y=[[g,l,f,m],[g,l,f,_],[f,l,g],[_,f],[_,g],[_,l]].map(S),x=(r,i)=>{for(let n,e=0;n=y[e];++e){const e=n[r],t=n[i];if(e>=0&&t>=0&&t>e)return Object.keys(n).slice(e,t+1)}return[]},D=()=>document.visibilityState===f?f:document.hasFocus()?g:l;class R extends s{constructor(){super();const e=D();this.s=e,this.i=[],this.a=this.a.bind(this),p.forEach(e=>addEventListener(e,this.a,!0)),v&&addEventListener("beforeunload",e=>{this.n=setTimeout(()=>{e.defaultPrevented||e.returnValue.length>0||this.r(e,f)},0)})}get state(){return this.s}get pageWasDiscarded(){return document.wasDiscarded||!1}addUnsavedChanges(e){!this.i.indexOf(e)>-1&&(0===this.i.length&&addEventListener("beforeunload",w),this.i.push(e))}removeUnsavedChanges(e){const t=this.i.indexOf(e);t>-1&&(this.i.splice(t,1),0===this.i.length&&removeEventListener("beforeunload",w))}r(i,t){if(t!==this.s){const e=this.s,r=x(e,t);for(let n=0;n<r.length-1;++n){const e=r[n],t=r[n+1];this.s=t,this.dispatchEvent(new d("statechange",{oldState:e,newState:t,originalEvent:i}))}}}a(e){switch(v&&clearTimeout(this.n),e.type){case"pageshow":case"resume":this.r(e,D());break;case"focus":this.r(e,g);break;case"blur":this.s===g&&this.r(e,D());break;case"pagehide":case"unload":this.r(e,e.persisted?_:m);break;case"visibilitychange":this.s!==_&&this.s!==m&&this.r(e,D());break;case"freeze":this.r(e,_)}}}var U=new R;var b={device_external_id:"_did",user_external_id:"_uid",user_is_authenticated:"_auth",user_external_id_hmac:"_uidh"},P=31536e3,C={active:"active",passive:"passive",hidden:"hidden",frozen:"frozen"},k={config:{workspace_id:"",host:"https://collector-eu.rimdian.com",session_timeout:1800,namespace:"_rmd_",cross_domains:[],ignored_origins:[],version:"2.0.0",log_level:"error",max_retry:10,from_cm:!1},isReady:!1,dispatchConsent:!1,currentUser:void 0,currentDevice:void 0,currentSession:void 0,currentPageview:void 0,currentPageviewVisibleSince:void 0,currentPageviewDuration:0,currentCart:void 0,itemsQueue:{items:[],add:function e(t,n){var r=k._getCookie("session");!r&&(["pageview","cart","order"].includes(t)||"custom_event"===t&&!0===n.non_interactive)&&k._startNewSession({utm_source:"direct",utm_medium:"none"});var i={kind:t};i[t]=n,["pageview","custom_event","cart","order"].includes(t)&&(i.user=a({},k.currentUser),i.session=a({},k.currentSession)),k.itemsQueue.items.push(i),k._localStorage.set("items",JSON.stringify(k.itemsQueue.items))},addPageviewDuration:function e(){if(k.currentPageview&&k.currentPageviewVisibleSince){var t=Math.round(((new Date).getTime()-k.currentPageviewVisibleSince.getTime())/1e3);k.currentPageviewDuration+=t,k.log("info","time spent on page is now",k.currentPageviewDuration);var n=a({},k.currentPageview),r=(new Date).toISOString();n.duration=k.currentPageviewDuration,n.updated_at=r,k.currentSession.duration||(k.currentSession.duration=0),k.currentSession.duration+=t,k.currentSession.updated_at=r,k.setSessionContext(k.currentSession);var i={kind:"pageview",pageview:n,user:a({},k.currentUser),session:a({},k.currentSession),device:a({},k.currentDevice)};k.itemsQueue.items.push(i),k._localStorage.set("items",JSON.stringify(k.itemsQueue.items))}}},dispatchQueue:[],isDispatching:!1,onReadyQueue:[],log:function e(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];"warn"===t?["warn","info","debug","trace"].includes(k.config.log_level)&&console.warn.apply(console,n):"info"===t?["info","debug","trace"].includes(k.config.log_level)&&console.info.apply(console,n):"debug"===t?["debug","trace"].includes(k.config.log_level)&&console.debug.apply(console,n):"trace"===t?"trace"===k.config.log_level&&console.trace.apply(console,n):console.error.apply(console,n)},init:function e(t){("complete"===document.readyState||"interactive"===document.readyState)&&k._onReady(t),document.onreadystatechange=function(){("interactive"===document.readyState||"complete"===document.readyState)&&(k.log("info","document is now",document.readyState),k._onReady(t))}},setDispatchConsent:function e(t){k.log("info","RMD dispatch consent is now",t),k.dispatchConsent=t},trackPageview:function e(t){if(!k.isReady)return k.log("debug","RMD is not yet ready for trackPageview, queuing function..."),void k._execWhenReady(function(){return k.trackPageview(t)});k.currentPageview&&!k.currentPageviewVisibleSince&&(k.log("info","previous pageview has been discarded, was not active"),k.currentPageview=void 0);var n=(new Date).toISOString();if(k.currentPageview){k.log("info","pageview already tracked");var r=Math.round(((new Date).getTime()-k.currentPageviewVisibleSince.getTime())/1e3);k.currentPageviewDuration+=r,k.currentPageview.duration=k.currentPageviewDuration,k.currentPageview.updated_at=n,k.currentSession.duration||(k.currentSession.duration=0),k.currentSession.duration+=r,k.currentSession.updated_at=n,k.itemsQueue.add("pageview",a({},k.currentPageview)),k.currentPageviewVisibleSince=void 0,k.currentPageviewDuration=0}var i=JSON.parse(JSON.stringify(t||{}));i.external_id=k.uuidv4(),i.created_at=n;var o=k.getReferrer();o&&(i.referrer=o),i.title||(i.title=document.title),i.page_id||(i.page_id=window.location.href),i.title=i.title.replace(/\\"/,'"'),i.product_price&&0<i.product_price&&(i.product_price=Math.round(100*i.product_price)),k.isPageVisible()&&(k.currentPageviewVisibleSince=new Date),k.currentPageview=i,k.currentUser.last_interaction_at=n,k.setUserContext(k.currentUser),k.currentSession.pageviews_count||(k.currentSession.pageviews_count=0),k.currentSession.interactions_count||(k.currentSession.interactions_count=0),k.currentSession.pageviews_count++,k.currentSession.interactions_count++,k.currentSession.updated_at=n,k.setSessionContext(k.currentSession),k.itemsQueue.add("pageview",a({},i))},trackCustomEvent:function e(t){if(!k.isReady)return k.log("debug","RMD is not yet ready for trackCustomEvent, queuing function..."),void k._execWhenReady(function(){return k.trackCustomEvent(t)});if(t&&!t.label)return void k.log("error","customEvent label is required");var n=JSON.parse(JSON.stringify(t||{})),r=(new Date).toISOString();n.external_id=k.uuidv4(),n.created_at=r,n.label=n.label.replace(/\\"/,'"'),n.string_value&&(n.string_value=n.string_value.replace(/\\"/,'"')),n.non_interactive||(k.currentUser.last_interaction_at=r,k.setUserContext(k.currentUser),!k.currentSession.interactions_count&&(k.currentSession.interactions_count=0),k.currentSession.interactions_count++,k.currentSession.updated_at=r,k.setSessionContext(k.currentSession)),k.itemsQueue.add("custom_event",a({},n))},trackCart:function e(t){if(!k.isReady)return k.log("debug","RMD is not yet ready for trackCart, queuing function..."),void k._execWhenReady(function(){return k.trackCart(t)});if(!t||"object"!==i(t))return void k.log("error","invalid cart data");var n=JSON.parse(JSON.stringify(t));if(k.log("info","cart is",n),n.external_id||(n.external_id=k.uuidv4()),n.session_external_id=k.currentSession.external_id,n.items&&n.items.forEach(function(e){e.cart_external_id=n.external_id,e.price&&0<e.price&&(e.price=Math.round(100*e.price))}),n.hash||(n.hash=k._cartHash(n)),!(k.currentCart&&(k.log("info","cart already tracked",a({},k.currentCart)),k.currentCart.hash===n.hash))){var r=(new Date).toISOString();n.updated_at||(n.updated_at=(new Date).toISOString()),k.currentCart=n,k.currentUser.last_interaction_at=r,k.currentSession.interactions_count||(k.currentSession.interactions_count=0),k.currentSession.interactions_count++,k.currentSession.updated_at=r,k.setSessionContext(k.currentSession),k.itemsQueue.add("cart",n)}},trackOrder:function e(t){if(!k.isReady)return k.log("debug","RMD is not yet ready for trackOrder, queuing function..."),void k._execWhenReady(function(){return k.trackOrder(t)});if(!t||"object"!==i(t))return void k.log("error","invalid order data");var n=JSON.parse(JSON.stringify(t));n.items&&n.items.forEach(function(e){e.price&&0<e.price&&(e.price=Math.round(100*e.price)),e.order_external_id=n.external_id});var r=(new Date).toISOString();k.currentUser.last_interaction_at=r,k.setUserContext(k.currentUser),k.currentSession.interactions_count||(k.currentSession.interactions_count=0),k.currentSession.interactions_count++,k.currentSession.updated_at=r,k.setSessionContext(k.currentSession),k.itemsQueue.add("order",n)},setDeviceContext:function e(t){if(!k.isReady)return k.log("debug","RMD is not yet ready for setDeviceContext, queuing function..."),void k._execWhenReady(function(){return k.setDeviceContext(t)});var n=a(a({},k.currentDevice),t);n.updated_at=(new Date).toISOString(),k.currentDevice=n,k._setCookie("device",JSON.stringify(k.currentDevice),P)},setSessionContext:function e(t){if(!k.isReady)return k.log("debug","RMD is not yet ready for setSessionContext, queuing function..."),void k._execWhenReady(function(){return k.setSessionContext(t)});var n=a(a({},k.currentSession),t);n.updated_at=(new Date).toISOString(),k.currentSession=n,k.log("info","RMD updated session is",n),k._setCookie("session",JSON.stringify(k.currentSession),k.config.session_timeout)},setUserContext:function e(t){if(!k.isReady)return k.log("debug","RMD is not yet ready for setUserContext, queuing function..."),void k._execWhenReady(function(){return k.setUserContext(t)});if(t&&void 0!==t.user_centric_consent&&(t.consent_all=t.user_centric_consent,delete t.user_centric_consent),t&&t.external_id&&""!==t.external_id&&t.external_id!==k.currentUser.external_id){if(k.currentUser.is_authenticated&&!0===t.is_authenticated)return k.log("info","new authenticated user detected, reset context",t),k.currentDevice=void 0,k._localStorage.remove("device"),k._createDevice(),k.currentSession=void 0,k._deleteCookie("session"),k._handleSession(),k.currentUser=a({},t),void(void 0===k.currentUser.created_at&&(k.currentUser.created_at=(new Date).toISOString()));k.currentUser.is_authenticated||(k.log("info","alias previous user",k.currentUser.external_id,"with user",t),k.itemsQueue.add("user_alias",{from_user_external_id:k.currentUser.external_id,to_user_external_id:t.external_id,to_user_is_authenticated:!0===t.is_authenticated,to_user_created_at:t.created_at?t.created_at:(new Date).toISOString()}))}var n=a(a({},k.currentUser),t);k.currentUser=n,k._setCookie("user",JSON.stringify(k.currentUser),P)},saveUserProfile:function e(){return k.isReady?void k.itemsQueue.add("user",a({},k.currentUser)):(k.log("debug","RMD is not yet ready for saveUserProfile, queuing function..."),void k._execWhenReady(function(){return k.saveUserProfile()}))},isPageVisible:function e(){return U.state===C.active},dispatch:function e(t){if(!1===k.isReady)return k.log("info","RMD is not ready, retrying dispatch soon..."),void window.setTimeout(function(){k.dispatch(t)},50);if(!k.dispatchConsent)return void k.log("info","RMD abort dispatch, no dispatch consent");if(0===k.itemsQueue.items.length&&0===k.dispatchQueue.length)return void k.log("info","RMD abort dispatch, no items to dispatch");var n=a({},k.currentDevice);n.user_agent!==navigator.userAgent&&(n.updated_at=(new Date).toISOString()),n.user_agent=navigator.userAgent,n.language=navigator.language,n.ad_blocker=k.hasAdBlocker(),n.resolution=window.screen&&window.screen.width&&window.screen.height?window.screen.height>window.screen.width?window.screen.height+"x"+window.screen.width:window.screen.width+"x"+window.screen.height:void 0;for(var r=[],i=[];0<k.itemsQueue.items.length;)i.push(k.itemsQueue.items.shift()),10<=i.length&&(r.push(i),i=[]);return 0<i.length&&r.push(i),r.forEach(function(e){e.forEach(function(e){e.device=n}),k.dispatchQueue.push({id:k.uuidv4(),workspace_id:k.config.workspace_id,items:e,context:{},created_at:(new Date).toISOString()})}),0===k.dispatchQueue.length?void k.log("info","RMD abort dispatch, no data imports to dispatch"):void(k._localStorage.set("dispatchQueue",JSON.stringify(k.dispatchQueue)),k.log("info","RMD sending data to collector"),k._initDispatchLoop(t))},_initDispatchLoop:function e(t){if(k.isDispatching)return void k.log("info","RMD abort dispatch, already dispatching");k.isDispatching=!0,k.dispatchQueue.sort(function(e,t){return e.created_at<t.created_at?-1:e.created_at>t.created_at?1:0});var n=k.dispatchQueue[0];k._postPayload(n,0,t)},_postPayload:function e(a,s,c){k._post(a,c,function(e){var t=!0;if(e){k.log("error","RMD post payload error",e);try{var n=JSON.parse(e)||{};400<n.code&&(t=!1)}catch(e){t=!1}if(k.log("info","sucess",t,"retry count",s),!1===t){if(s>=k.config.max_retry)return k.isDispatching=!1,void k.log("info","max retry reached, aborting");var r=100;if(1<s)for(var i=0;i<s;i++)r*=2;return k.log("debug","retry in "+r+"ms"),void window.setTimeout(function(){s++,k._postPayload(a,s,c)},r)}}if(!0==t){var o=[];k.dispatchQueue.forEach(function(e){e.id!==a.id&&o.push(e)}),k.dispatchQueue=o,k._localStorage.set("dispatchQueue",JSON.stringify(k.dispatchQueue)),k.isDispatching=!1,0<k.dispatchQueue.length&&k._initDispatchLoop(c)}})},_post:function e(t,n,r){t.context.data_sent_at=(new Date).toISOString();var i=JSON.stringify(t);if(k.log("info","RMD sending data",i),n&&navigator.sendBeacon){var o=navigator.sendBeacon(k.config.host+"/live",new Blob([i],{type:"application/json"}));return r(o?null:"sendBeacon failed")}var a=new XMLHttpRequest;a.onload=function(){var e="response"in a?a.response:a.responseText;return 300<=a.status?r(e):r(null)},a.onerror=function(){return r("network request failed")},a.ontimeout=function(){return r("network request timeout")},a.open("POST",k.config.host+"/live",!0),a.setRequestHeader("Content-Type","application/json"),a.withCredentials=!0,a.send(i)},_handleUser:function e(){var t=["{{","}}","{%","%}","{#","#}","*|","|*"],n=k._getCookie("user"),r={};n&&""!==n&&(r=JSON.parse(n),t.some(function(e){return r.external_id&&-1!==r.external_id.indexOf(e)})&&(r={},n=""),!0===k.config.from_cm&&r.id!==void 0&&r.external_id===void 0&&(r={external_id:r.id,is_authenticated:r.is_authenticated||!1,created_at:(new Date).toISOString(),hmac:r.hmac||void 0}));var i=k.getQueryParam(document.URL,b.user_external_id);if(i&&""!==i&&t.every(function(e){return-1===i.indexOf(e)})){k.log("info","found user ID in URL",i);var o=k.getQueryParam(document.URL,b.user_is_authenticated);return k.log("info","user authenticated URL value",o),k.currentUser={external_id:i,is_authenticated:"true"===o||"1"===o,created_at:(new Date).toISOString(),hmac:k.getQueryParam(document.URL,b.user_external_id_hmac)},n&&""!==n&&(k.log("info","found another user ID in cookie",n),!1===r.is_authenticated&&r.external_id!==k.currentUser.external_id&&(k.log("info","alias previous user",r.external_id,"with user",k.currentUser.external_id),k.itemsQueue.add("user_alias",{from_user_external_id:r.external_id,to_user_external_id:k.currentUser.external_id,to_user_is_authenticated:k.currentUser.is_authenticated,to_user_created_at:k.currentUser.created_at}))),void k._setCookie("user",JSON.stringify(k.currentUser),P)}return n&&""!==n?(k.log("info","found user ID in cookie",n),k.currentUser=r,void k._setCookie("user",JSON.stringify(k.currentUser),P)):void k._createUser(k.uuidv4(),!1,(new Date).toISOString())},_createUser:function e(t,n,r){k.currentUser={external_id:t,is_authenticated:n,created_at:r},k.log("info","creating new user",a({},k.currentUser)),k._setCookie("user",JSON.stringify(k.currentUser),P)},_enrichUserContext:function e(){var t=[{key:"email",value:k.getQueryParam(document.URL,"_email")},{key:"email_md5",value:k.getQueryParam(document.URL,"_emailmd5")},{key:"email_sha1",value:k.getQueryParam(document.URL,"_emailsha1")},{key:"email_sha256",value:k.getQueryParam(document.URL,"_emailsha256")},{key:"telephone",value:k.getQueryParam(document.URL,"_telephone")}];t.forEach(function(e){e.value&&""!==e.value&&(k.currentUser[e.key]=e.value)}),k._setCookie("user",JSON.stringify(k.currentUser),P)},_handleDevice:function e(){var t=k.getQueryParam(document.URL,b.device_external_id);if(t&&""!==t)return k.log("info","found device ID in URL",t),k.currentDevice={external_id:t,created_at:(new Date).toISOString(),user_agent:navigator.userAgent},void k._setCookie("device",JSON.stringify(k.currentDevice),P);var n=k._getCookie("device");if(n&&""!==n){if(k.log("info","found device ID in cookie",n),k.currentDevice=JSON.parse(n),!0===k.config.from_cm){var r=k._getCookie("_cm_cid");if(r&&""!==r){k.currentDevice.external_id=r;var i=k._getCookie("_cm_cidat");i&&""!==i&&(k.currentDevice.created_at=new Date(parseInt(i,10)).toISOString())}}return void k._setCookie("device",JSON.stringify(k.currentDevice),P)}k._createDevice()},_createDevice:function e(){k.log("info","creating new device ID"),k.currentDevice={external_id:k.uuidv4(),created_at:(new Date).toISOString(),user_agent:navigator.userAgent},k._setCookie("device",JSON.stringify(k.currentDevice),P)},_addEventListener:function e(t,n,r,i){return t.addEventListener?(t.addEventListener(n,r,i),!0):t.attachEvent?t.attachEvent("on"+n,r):void(t["on"+n]=r)},_onReady:function e(t){if(!k.isReady){if(k.isReady=!0,k.log("info","onReady() called"),!k.isBrowserLegit())return void k.log("warn","Browser is not legit");var n=a(a({},k.config),t);if(k.config=n,k.log("info","RMD Config is:",k.config),window.localStorage&&(k.itemsQueue.items=JSON.parse(localStorage.getItem(k.config.namespace+"items")||"[]"),k.dispatchQueue=JSON.parse(localStorage.getItem(k.config.namespace+"dispatchQueue")||"[]")),k._handleUser(),k._enrichUserContext(),k._handleDevice(),k._handleSession(),0<k.onReadyQueue.length&&(k.onReadyQueue.forEach(function(e){k.log("debug","executing queued function",e),e()}),k.onReadyQueue=[]),window.setInterval(function(){if(k.currentPageview&&k.isPageVisible()){var e=k._getCookie("session");e&&k._setCookie("session",e,k.config.session_timeout)}},6e4),0<k.config.cross_domains.length)for(var r,i=0;i<document.links.length;i++)r=document.links[i],k.config.cross_domains.forEach(function(e){-1!==r.href.indexOf(e)&&(k._addEventListener(r,"click",k._decorateURL,!0),k._addEventListener(r,"mousedown",k._decorateURL,!0))});U.addEventListener("statechange",function(e){k.log("info","page state changed from",e.oldState,"to",e.newState),e.oldState===C.active&&e.newState===C.passive?k._onPagePassive():e.oldState===C.passive&&e.newState===C.active&&k._onPageActive()})}},_execWhenReady:function e(t){k.isReady?t():k.onReadyQueue.push(t)},_handleSession:function e(){var t=k.getQueryParam(document.URL,"utm_source")||k.getHashParam(window.location.hash,"utm_source"),n=k.getQueryParam(document.URL,"utm_medium")||k.getHashParam(window.location.hash,"utm_medium"),r=k.getQueryParam(document.URL,"utm_campaign")||k.getHashParam(window.location.hash,"utm_campaign"),i=k.getQueryParam(document.URL,"utm_content")||k.getHashParam(window.location.hash,"utm_content"),o=k.getQueryParam(document.URL,"utm_term")||k.getHashParam(window.location.hash,"utm_term"),a=k.getQueryParam(document.URL,"utm_id")||k.getHashParam(window.location.hash,"utm_id"),s=k.getQueryParam(document.URL,"utm_id_from")||k.getHashParam(window.location.hash,"utm_id_from"),c=k.getReferrer();if(c){var u=document.createElement("a");u.href=c;var d=!1;if(u.hostname&&u.hostname!==window.location.hostname){var g=!1;k.config.cross_domains&&k.config.cross_domains.length&&k.config.cross_domains.forEach(function(e){-1!==u.href.indexOf(e)&&(g=!0)}),!1==g&&(d=!0)}d&&(t=u.hostname,(!n||""===n)&&(n="referral"),0===c.search("https?://(.*)google.([^/?]*)")?o=k.getQueryParam(c,"q"):0===c.search("https?://(.*)bing.com")?o=k.getQueryParam(c,"q"):0===c.search("https?://(.*)search.yahoo.com")?o=k.getQueryParam(c,"p"):0===c.search("https?://(.*)ask.com")?o=k.getQueryParam(c,"q"):0===c.search("https?://(.*)search.aol.com")?o=k.getQueryParam(c,"q"):0===c.search("https?://(.*)duckduckgo.com")&&(o=k.getQueryParam(c,"q")))}["gclid","fbclid","msclkid"].forEach(function(e){var t=k.getQueryParam(document.URL,e)||k.getHashParam(window.location.hash,e);t&&(a=t,s=e)}),"gclid"===s&&"referral"===n&&(n="ads"),t&&""!==t||(t="direct"),n&&""!==n||(n="none"),k.log("info","RMD utm_source is:",t),k.log("info","RMD utm_medium is:",n),k.log("info","RMD utm_campaign is:",r),k.log("info","RMD utm_content is:",i),k.log("info","RMD utm_term is:",o),k.log("info","RMD utm_id is:",a),k.log("info","RMD utm_id_from is:",s);var l=k._getCookie("session");if(!l||""===l)return void k._startNewSession({utm_source:t,utm_medium:n,utm_campaign:r,utm_content:i,utm_term:o,utm_id:a,utm_id_from:s});var f;t&&""!==t&&0<k.config.ignored_origins.length&&(f=k.config.ignored_origins.find(function(e){return e.utm_source===t&&e.utm_medium===n&&(!(e.utm_campaign&&""!==e.utm_campaign)||!!(r&&e.utm_campaign===r))}));var _=JSON.parse(l);if(k.log("info","RMD existing session is:",_),!0===k.config.from_cm&&void 0!==_.from){_={external_id:_.id,created_at:(new Date).toISOString(),device_external_id:k.currentDevice.external_id,landing_page:window.location.href,referrer:k.getReferrer(),timezone:k.getTimezone(),utm_source:_.from.source||"direct",utm_medium:_.from.medium||"none",utm_campaign:_.from.campaign||void 0,utm_content:_.from.creative||void 0,utm_term:_.from.keyword||void 0,utm_id:_.from.gclid||void 0,utm_id_from:_.from.gclid&&""!==_.from.gclid?"gclid":void 0};var m=k._getCookie("_cm_sessionExpiresAt");m&&""!==m&&(_.created_at=new Date(m).toISOString()),k._setCookie("session",JSON.stringify(k.currentSession),k.config.session_timeout)}var v=!0;return _.utm_source!==t&&(v=!1),_.utm_medium!==n&&(v=!1),_.utm_campaign!==r&&(v=!1),_.utm_content!==i&&(v=!1),_.utm_term!==o&&(v=!1),_.utm_id!==a&&(v=!1),f||v||!t||""===t?(k.log("info","RMD resume session (ignored:"+(f?"yes":"no")+", isEqual:"+v+", utm_source:"+t+")"),k.currentSession=_,void k._setCookie("session",JSON.stringify(k.currentSession),k.config.session_timeout)):void k._startNewSession({utm_source:t,utm_medium:n,utm_campaign:r,utm_content:i,utm_term:o,utm_id:a,utm_id_from:s})},_onPagePassive:function e(){k.log("info","page is passive state"),k.itemsQueue.addPageviewDuration(),k.dispatch(!0)},_onPageActive:function e(){k.log("info","page is active state");k.currentPageview&&(k.currentPageviewVisibleSince=new Date)},getTimezone:function e(){var t,n=null===(t=window.Intl)||void 0===t?void 0:t.DateTimeFormat;if(n){var r=(new n).resolvedOptions().timeZone;if(r)return r}},getQueryParam:function e(t,n){try{var r=new URL(t),i=new URLSearchParams(r.search);return i.get(n)||void 0}catch(t){}},getHashParam:function e(t,n){var r=t.match(new RegExp(n+"=([^&]*)"));return r?r[1]:void 0},updateURLParam:function e(t,n,r){var i=new URL(t),o=new URLSearchParams(i.search);return o.set(n,r),i.search=o.toString(),i.toString()},hasAdBlocker:function e(){var t=document.createElement("div");t.innerHTML="&nbsp;",t.className="adsbox";var n=!1;try{document.body.appendChild(t),n=0===document.getElementsByClassName("adsbox")[0].offsetHeight,document.body.removeChild(t)}catch(t){n=!1}return n},isBrowserLegit:function e(){var t=navigator.userAgent.toLowerCase();return!(-1!==t.indexOf("msie")&&9>=parseInt(t.split("msie")[1],10))&&!/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp|nuhk|yammybot|openbot|slurp|msnBot|ask jeeves\/teoma|ia_archiver)/i.test(navigator.userAgent)&&!navigator.webdriver},uuidv4:function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})},md5:function e(t){return r(t)},getReferrer:function e(){var t;try{t=""===window.top.document.referrer?void 0:window.top.document.referrer}catch(e){if(window.parent)try{t=""===window.parent.document.referrer?void 0:window.parent.document.referrer}catch(e){t=void 0}}return t||(t=""===document.referrer?void 0:document.referrer),t},_startNewSession:function e(t){k.currentSession={external_id:k.uuidv4(),created_at:(new Date).toISOString(),device_external_id:k.currentDevice.external_id,landing_page:window.location.href,referrer:k.getReferrer(),timezone:k.getTimezone(),utm_source:t.utm_source,utm_medium:t.utm_medium,utm_campaign:t.utm_campaign,utm_content:t.utm_content,utm_term:t.utm_term,utm_id:t.utm_id,utm_id_from:t.utm_id_from,duration:0,pageviews_count:0,interactions_count:0},k.log("info","RMD new session is:",k.currentSession),k._setCookie("session",JSON.stringify(k.currentSession),k.config.session_timeout)},_getCookie:function e(t){return t=k.config.namespace+t,decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[-.+*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},_setCookie:function e(t,n,r){t=k.config.namespace+t;var i=window.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),o=i?i[0]:"",a=o?"; domain=."+o:"",s=new Date;s.setTime(s.getTime()+1e3*r);var c="; expires="+s.toUTCString(),u=t+"="+encodeURIComponent(n)+c+"; path=/"+a+"; secure";document.cookie=u},_deleteCookie:function e(t){k._setCookie(t,"",-1)},_localStorage:{get:function e(t){return localStorage.getItem(k.config.namespace+t)},set:function e(t,n){try{localStorage.setItem(k.config.namespace+t,n)}catch(t){k.log("error","localStorage error:",t)}},remove:function e(t){localStorage.removeItem(k.config.namespace+t)}},_decorateURL:function e(t){var n=t.target;n.href=k.updateURLParam(n.href,b.device_external_id,k.currentDevice.external_id),n.href=k.updateURLParam(n.href,b.user_external_id,k.currentUser.external_id),n.href=k.updateURLParam(n.href,b.user_is_authenticated,k.currentUser.is_authenticated.toString()),k.currentUser.hmac&&(n.href=k.updateURLParam(n.href,b.user_external_id_hmac,k.currentUser.hmac))},_cartHash:function e(t){var n=t.public_url?t.public_url:"";return t.items&&0<t.items.length&&t.items.forEach(function(e){n=n+e.product_external_id+(e.variant_external_id?e.variant_external_id:"")+(e.quantity||"0")}),r(n)},_wipeAll:function e(){window.confirm("Do you know what you are doing?")&&(k._deleteCookie("device"),k._deleteCookie("user"),k._deleteCookie("session"),k._localStorage.remove("items"),k._localStorage.remove("dispatchQueue"),k.currentUser=void 0,k.currentDevice=void 0,k.currentSession=void 0,k.currentCart=void 0,k.currentPageview=void 0,k.isReady=!1,k._onReady(k.config))}};return k}();